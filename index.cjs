const http = require('http');
const { connect } = require('net');
 
/****************** 工具方法 ******************/
const getHostPort = (host, defaultPort) => {
  let port = defaultPort || 80;
  const index = host.indexOf(':');
  if (index !== -1) {
    port = host.substring(index + 1);
    host = host.substring(0, index);
  }
  return {host, port};
};
 
const getOptions = (req, defaultPort) => {
  // 这里假定 host 一定存在，完整实现参见 Whistle
  const { host, port } = getHostPort(req.headers.host, defaultPort);
  return {
    hostname: host, // 指定请求域名，用于通过 DNS 获取服务器 IP 及设置请求头 host 字段
    port, // 指定服务器端口
    path: req.url || '/',
    method: req.method,
    headers: req.headers,
    rejectUnauthorized: false, // 给 HTTPS 请求用的，HTTP 请求会自动忽略
  };
};
 
// 简单处理，出错直接断开，完整实现逻辑参考 Whistle
const handleClose = (req, res) => {
  const destroy = (err) => { // 及时关闭无用的连接，防止内存泄露
    req.destroy();
    res && res.destroy();
  };
  res && res.on('error', destroy);
  req.on('error', destroy);
  req.once('close', destroy);
};
 
 
/****************** 服务代码 ******************/
const server = http.createServer();
// 处理 HTTP 请求
server.on('request', (req, res) => {
  // 与服务端建立连接，透传客户端请求及服务端响应内容
  const client = http.request(getOptions(req), (svrRes) => {
    res.writeHead(svrRes.statusCode, svrRes.headers);
    svrRes.pipe(res);
  });
  req.pipe(client);
  handleClose(res, client);
});
 
// 隧道代理：处理 HTTPS、HTTP2、WebSocket、TCP 等请求
server.on('connect', (req, socket) => {
  // 与服务端建立连接，透传客户端请求及服务端响应内容
  const client = connect(getHostPort(req.url), () => {
    socket.write('HTTP/1.1 200 Connection Established\r\n\r\n');
    socket.pipe(client).pipe(socket);
  });
  handleClose(socket, client);
});
 
server.listen(8080);


{"state":{"chats":[{"title":"Demo","messages":[{"role":"system","content":"I am an advanced web3 data analytics tool, leveraging the capabilities of GPT for comprehensive analysis."},{"role":"user","content":"could you provide me with the most active DApps on the Polkadot blockchain in the past month, along with a summary analysis of their activity"},{"role":"assistant","content":"Over the past month, the three most active DApps on the Polkadot blockchain are Moonbeam, Acala, and Bifrost."},{"role":"assistant","content":"\nMoonbeam shows significant activity with two daily trading peaks occurring around 14:00 and 18:00. Total issuance is 1.075 billion with 55% circulating, 35% staking, and 10% others. The DApp boasts 1,197,562 holders with a total of 9,187,220 transfers. It has a robust Finalized and Signed Extrinsics data at 3,971,389 and 403,921 respectively. Its staked/bonded data stands at 330.597M/357.366M.\n\n  ```chart\n  {\n    \"charts\": [\n      [\n        {\n          \"type\": \"line\",\n          \"title\": \"Chain Status\",\n          \"col\": 6,\n          \"data\": [{\"X\":\"02:00\",\"Y\":\"31801.268141121563060173\"},{\"X\":\"03:00\",\"Y\":\"108708.051093385286979111\"},{\"X\":\"04:00\",\"Y\":\"76193.023641541970358516\"},{\"X\":\"05:00\",\"Y\":\"339001.335700414284688408\"},{\"X\":\"06:00\",\"Y\":\"103591.542399897892685131\"},{\"X\":\"07:00\",\"Y\":\"34126.459541854306858196\"},{\"X\":\"08:00\",\"Y\":\"658157.815725249560126975\"},{\"X\":\"09:00\",\"Y\":\"876594.567003387961116544\"},{\"X\":\"10:00\",\"Y\":\"132133.68109228143198262\"},{\"X\":\"11:00\",\"Y\":\"97741.086653349060921324\"},{\"X\":\"12:00\",\"Y\":\"108164.753699356045055225\"},{\"X\":\"13:00\",\"Y\":\"1490250.837372861207450496\"},{\"X\":\"14:00\",\"Y\":\"13461407.906618980581934807\"},{\"X\":\"15:00\",\"Y\":\"817572.065298112945657062\"},{\"X\":\"16:00\",\"Y\":\"1306296.35982249656604392\"},{\"X\":\"17:00\",\"Y\":\"11103728.60910576176169851\"},{\"X\":\"18:00\",\"Y\":\"1440991.530638401818047797\"},{\"X\":\"19:00\",\"Y\":\"1822411.431090168826801691\"},{\"X\":\"20:00\",\"Y\":\"361972.355628987633061369\"},{\"X\":\"21:00\",\"Y\":\"2419749.264239594813392028\"},{\"X\":\"22:00\",\"Y\":\"1160962.719875787044960834\"},{\"X\":\"23:00\",\"Y\":\"2478835.620876750353848694\"},{\"X\":\"00:00\",\"Y\":\"800583.624863420256562721\"},{\"X\":\"01:00\",\"Y\":\"843750.573606908291997899\"}]\n        },\n        {\n          \"type\": \"none\",\n          \"col\": 1,\n          \"data\": [\n            \n          ]\n        },\n        {\n            \"type\": \"pie\",\n            \"col\": 5,\n            \"title\": \"Total Issuance\",\n            \"total\": \"1.075 B\",\n            \"data\": [{\"name\":\"Circulating\",\"value\":678792000},{\"name\":\"Staking\",\"value\":357312000},{\"name\":\"Others\",\"value\":39217000}]\n          }\n      ],\n      [\n        {\n          \"type\": \"cardList\",\n          \"col\": 12,\n          \"title\": \"Chain Data\",\n          \"data\": [[{\"title\":\"Finalized Blocks\",\"value\":\"3,971,389\"},{\"title\":\"Signed Extrinsics\",\"value\":\"403,921\"},{\"title\":\"Staked / Bonded\",\"value\":\"330.597 M / 357.366 M\"}],[{\"title\":\"Holders\",\"value\":\"1,197,562\"},{\"title\":\"Transfers\",\"value\":\"9,187,220\"},{\"title\":\"polkadot Para ID\",\"value\":\"2,004\"}]]\n        }\n      ]\n    ]\n  }\n  ```\n  Acala maintains a healthy trading volume with the trading peaks occurring between 10:00-14:00 and 24:00. It has a total issuance of 999.999M with a distribution of 60% circulating and 40% others. It sustains a Finalized data of 3,989,442, Signed Extrinsics data of 2,932,633, and has facilitated 4,348,737 transfers among its 159,251 holders.\n\n  ```chart\n  {\n    \"charts\": [\n      [\n        {\n          \"type\": \"line\",\n          \"title\": \"Chain Status\",\n          \"col\": 6,\n          \"data\": [{\"X\":\"02:00\",\"Y\":\"117.691066033771\"},{\"X\":\"03:00\",\"Y\":\"398.602587503964\"},{\"X\":\"04:00\",\"Y\":\"693.04820351393\"},{\"X\":\"05:00\",\"Y\":\"31869.868417691542\"},{\"X\":\"06:00\",\"Y\":\"27363.673725140942\"},{\"X\":\"07:00\",\"Y\":\"18995.003666889367\"},{\"X\":\"08:00\",\"Y\":\"216796.728154734719\"},{\"X\":\"09:00\",\"Y\":\"201954.004381726427\"},{\"X\":\"10:00\",\"Y\":\"472182.934424648077\"},{\"X\":\"11:00\",\"Y\":\"1277673.739661153427\"},{\"X\":\"12:00\",\"Y\":\"1249935.500661434412\"},{\"X\":\"13:00\",\"Y\":\"338280.628042484704\"},{\"X\":\"14:00\",\"Y\":\"279284.770752362329\"},{\"X\":\"15:00\",\"Y\":\"247327.401011821879\"},{\"X\":\"16:00\",\"Y\":\"154716.121281750877\"},{\"X\":\"17:00\",\"Y\":\"567241.348254443247\"},{\"X\":\"18:00\",\"Y\":\"43914.733341083414\"},{\"X\":\"19:00\",\"Y\":\"639595.657237676248\"},{\"X\":\"20:00\",\"Y\":\"618060.528809242611\"},{\"X\":\"21:00\",\"Y\":\"278237.927559170169\"},{\"X\":\"22:00\",\"Y\":\"108208.516982067907\"},{\"X\":\"23:00\",\"Y\":\"52964.327643682771\"},{\"X\":\"00:00\",\"Y\":\"40558.665022396059\"},{\"X\":\"01:00\",\"Y\":\"1882901.484175334609\"}]\n        },\n        {\n          \"type\": \"none\",\n          \"col\": 1,\n          \"data\": [\n            \n          ]\n        },\n        {\n            \"type\": \"pie\",\n            \"col\": 5,\n            \"title\": \"Total Issuance\",\n            \"total\": \"999.999 M\",\n            \"data\": [{\"name\":\"Circulating\",\"value\":602107000},{\"name\":\"Others\",\"value\":379892000}]\n          }\n      ],\n      [\n        {\n          \"type\": \"cardList\",\n          \"col\": 12,\n          \"title\": \"Chain Data\",\n          \"data\": [[{\"title\":\"Finalized Blocks\",\"value\":\"3,989,442\"},{\"title\":\"Signed Extrinsics\",\"value\":\"2,932,633\"},{\"title\":\"Total Issuance\",\"value\":\"999.999 M\"}],[{\"title\":\"Holders\",\"value\":\"159,251\"},{\"title\":\"Transfers\",\"value\":\"4,348,737\"}]]\n        }\n      ]\n    ]\n  }\n  ```\n  Bifrost registers peak trading activity between 17:00-18:00. It has a total issuance of 999.999M, 85% of which is circulating and the remaining 15% marked as others. It has Finalized and Signed Extrinsics data standing at 2,700,515 and 101,505 respectively. The DApp has been utilized by 4,569 holders with 76,352 transfers in total.\n\n  ```chart\n  {\n    \"charts\": [\n      [\n        {\n          \"type\": \"line\",\n          \"title\": \"Chain Status\",\n          \"col\": 6,\n          \"data\": [{\"X\":\"02:00\",\"Y\":\"20.529768370072\"},{\"X\":\"03:00\",\"Y\":\"293.954225169637\"},{\"X\":\"04:00\",\"Y\":\"12.260061600495\"},{\"X\":\"05:00\",\"Y\":\"11.70093671033\"},{\"X\":\"06:00\",\"Y\":\"487.330562688124\"},{\"X\":\"07:00\",\"Y\":\"140.969138163667\"},{\"X\":\"08:00\",\"Y\":\"4.175944044144\"},{\"X\":\"09:00\",\"Y\":\"14.309033442645\"},{\"X\":\"10:00\",\"Y\":\"0\"},{\"X\":\"11:00\",\"Y\":\"0\"},{\"X\":\"12:00\",\"Y\":\"0.391294362946\"},{\"X\":\"13:00\",\"Y\":\"0.587557554196\"},{\"X\":\"14:00\",\"Y\":\"0\"},{\"X\":\"15:00\",\"Y\":\"20.001185375091\"},{\"X\":\"16:00\",\"Y\":\"0.991295333482\"},{\"X\":\"17:00\",\"Y\":\"17758.709831341637\"},{\"X\":\"18:00\",\"Y\":\"385.884282292999\"},{\"X\":\"19:00\",\"Y\":\"225.518718928503\"},{\"X\":\"20:00\",\"Y\":\"9.851962536782\"},{\"X\":\"21:00\",\"Y\":\"4.1948\"},{\"X\":\"22:00\",\"Y\":\"347.775660646615\"},{\"X\":\"23:00\",\"Y\":\"0\"},{\"X\":\"00:00\",\"Y\":\"0.2\"},{\"X\":\"01:00\",\"Y\":\"0.391631619088\"}]\n        },\n        {\n          \"type\": \"none\",\n          \"col\": 1,\n          \"data\": [\n            \n          ]\n        },\n        {\n            \"type\": \"pie\",\n            \"col\": 5,\n            \"title\": \"Total Issuance\",\n            \"total\": \"999.999 M\",\n            \"data\": [{\"name\":\"Circulating\",\"value\":10479000},{\"name\":\"Others\",\"value\":69520000}]\n          }\n      ],\n      [\n        {\n          \"type\": \"cardList\",\n          \"col\": 12,\n          \"title\": \"Chain Data\",\n          \"data\": [[{\"title\":\"Finalized Blocks\",\"value\":\"2,700,515\"},{\"title\":\"Signed Extrinsics\",\"value\":\"101,505\"},{\"title\":\"Total Issuance\",\"value\":\"79.999 M\"}],[{\"title\":\"Holders\",\"value\":\"4,569\"},{\"title\":\"Transfers\",\"value\":\"76,352\"},{\"title\":\"polkadot Para ID\",\"value\":\"2,030\"}]]\n        }\n      ]\n    ]\n  }\n  ```\n  "},{"role":"user","content":"what is our current strategy considering the Bitcoin market trend, and how do we adjust it for short and ultra-short-term trading"},{"role":"assistant","content":"\nIn analyzing Bitcoin's current dynamics, we maintain our strategy. We're eyeing long positions around the 29,000 mark, complemented by increased spot purchases. With the market showing a 0.618 Fibonacci retracement, it's an apt time to accumulate, preparing for an upward breakout.\n\nIn the ultra-short-term scenario, consider the exchange's liquidation chart. It displays abundant short positions suitable for liquidation. It's recommended to enter around 29,850, with profit-taking at 30,560, and placing a stop loss at 29,380.\n\nAvoid round integer pending orders for better risk management. As market data evolves, our strategic points need adjusting.\n\n![img](https://img1.imgtp.com/2023/07/12/TIOHjiWO.svg)\n"},{"role":"user","content":"what insights and investment strategies can be gleaned from the correlation between the ETH price and its inflow and outflow on the Binance exchange"},{"role":"assistant","content":"\nUpon examining the correlation between Ethereum (ETH) price fluctuations and ETH inflows and outflows on Binance, we unearth key insights that suggest a discernible pattern. Specifically, we notice substantial inflows and outflows aligning with significant price movements. For instance, an outflow of 17,500 ETH on May 11th and 13th corresponded to a drop in price to approximately 1785, whereas an inflow of 23,085 ETH on May 23rd coincided with a price hike to 1940.\n\nThe observed patterns potentially indicate that large inflows tend to precede price rises, while significant outflows may signal impending price drops, possibly driven by 'whale' transactions – substantial trades by major holders that can influence the market.\n\nDrawing from this analysis, we recommend that investors closely monitor such inflow and outflow activities, as they could serve as precursors to significant price movements. Investors might consider buying ahead of large inflows and selling prior to significant outflows.\n\n![img](https://img1.imgtp.com/2023/07/12/k7esWv58.svg)\n"}],"config":{"model":"gpt-3.5-turbo","max_tokens":4000,"temperature":1,"presence_penalty":0,"top_p":1,"frequency_penalty":0},"titleSet":false}],"currentChatIndex":0,"apiKey":"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","apiEndpoint":"https://api.openai.com/v1/chat/completions","theme":"light","autoTitle":false,"prompts":[{"id":"0d3e9cb7-b585-43fa-acc3-840c189f6b93","name":"English Translator","prompt":"I want you to act as an English translator, spelling corrector and improver. I will speak to you in any language and you will detect the language, translate it and answer in the corrected and improved version of my text, in English. I want you to replace my simplified A0-level words and sentences with more beautiful and elegant, upper level English words and sentences. Keep the meaning same, but make them more literary. I want you to only reply the correction, the improvements and nothing else, do not write explanations. Do you understand?"}],"defaultChatConfig":{"model":"gpt-3.5-turbo","max_tokens":4000,"temperature":1,"presence_penalty":0,"top_p":1,"frequency_penalty":0},"defaultSystemMessage":"I am an advanced web3 data analytics tool, leveraging the capabilities of GPT for comprehensive analysis.","hideMenuOptions":false,"firstVisit":true,"hideSideMenu":false,"foldersName":[],"foldersExpanded":[]},"version":4}